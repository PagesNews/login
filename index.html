<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Salud Felina | Panleucopenia</title>

<style>
body{
  font-family:Arial, sans-serif;
  background:#f3f7f6;
  color:#2e3d38;
}
section{
  max-width:400px;
  margin:60px auto;
  background:white;
  padding:30px;
  border-radius:15px;
  box-shadow:0 10px 25px rgba(0,0,0,.1);
}
input,button{
  width:100%;
  padding:12px;
  margin-top:10px;
}
button{
  background:#6bb9a7;
  color:white;
  border:none;
  cursor:pointer;
}
button:hover{background:#5aa393}
hr{margin:20px 0}
#contenido{display:none}
</style>

</head>
<body>

<section id="loginBox">
  <h2>Acceso</h2>

  <input id="email" type="email" placeholder="Correo">
  <input id="password" type="password" placeholder="Contraseña">

  <button id="registerBtn">Registrarme</button>
  <button id="loginBtn">Iniciar sesión</button>

  <hr>

  <button id="googleBtn">Continuar con Google</button>

  <p id="msg"></p>
</section>

<section id="contenido">
  <h2>Contenido privado</h2>
  <p>Ya estás logueado correctamente ✅</p>
</section>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
  getAuth,
  createUserWithEmailAndPassword,
  signInWithEmailAndPassword,
  GoogleAuthProvider,
  signInWithPopup,
  fetchSignInMethodsForEmail,
  onAuthStateChanged
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import {
  getFirestore,
  doc,
  setDoc,
  getDoc,
  serverTimestamp
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCdACTc1qQAFWDbkxnBnW58opthZgNytAs",
  authDomain: "login07540.firebaseapp.com",
  projectId: "login07540",
  storageBucket: "login07540.firebasestorage.app",
  messagingSenderId: "729426958528",
  appId: "1:729426958528:web:a2cc1a3aba1997e11f3525"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const email = document.getElementById("email");
const password = document.getElementById("password");
const msg = document.getElementById("msg");

/* REGISTRAR */
registerBtn.onclick = async () => {
  try {
    const methods = await fetchSignInMethodsForEmail(auth, email.value);
    if (methods.length > 0) {
      msg.textContent = "⚠️ Correo ya registrado, inicia sesión";
      return;
    }

    const cred = await createUserWithEmailAndPassword(auth, email.value, password.value);

    await setDoc(doc(db, "usuarios", cred.user.uid), {
      email: cred.user.email,
      proveedor: "password",
      fecha: serverTimestamp()
    });

    msg.textContent = "✅ Correo registrado correctamente";

  } catch (e) {
    msg.textContent = e.message;
  }
};

/* LOGIN */
loginBtn.onclick = async () => {
  try {
    const methods = await fetchSignInMethodsForEmail(auth, email.value);
    if (methods.length === 0) {
      msg.textContent = "❌ Correo no registrado, regístrate primero";
      return;
    }

    await signInWithEmailAndPassword(auth, email.value, password.value);
    msg.textContent = "✅ Sesión iniciada";

  } catch (e) {
    msg.textContent = e.message;
  }
};

/* GOOGLE */
googleBtn.onclick = async () => {
  try {
    const provider = new GoogleAuthProvider();
    const result = await signInWithPopup(auth, provider);

    const ref = doc(db, "usuarios", result.user.uid);
    const snap = await getDoc(ref);

    if (!snap.exists()) {
      await setDoc(ref, {
        email: result.user.email,
        proveedor: "google",
        fecha: serverTimestamp()
      });
    }

  } catch (e) {
    msg.textContent = e.message;
  }
};

/* SESIÓN */
onAuthStateChanged(auth, user => {
  if (user) {
    document.getElementById("loginBox").style.display = "none";
    document.getElementById("contenido").style.display = "block";
  }
});
</script>

</body>
</html>
